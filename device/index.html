<!DOCTYPE html>
<html lang="en">
<head>
    <title>Windows Volume Mixer Controller</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body style="background-color:#252525; color:white; height:100vh" onload="myOnload()">
    <div class="container-fluid vertically-center" style="margin:auto 0px;">
        <h1 class="text-center p-0">Volume Control</h1>
        <div class="container-fluid horizontal-scrollable">
            <div class="row text-center col-10 offset-1" id="sliderContainer">
                <div class="col-xs-3">
                    <input id="masterVolume" type="range" min="0" max="100" class="slider">
                    <h3 class="text-center" id="testslider1name">Master</h3>
                    <input type="checkbox" id="muteUnmuteApp">
                    <label for="muteUnmuteApp" class="unmute">
                        <img src="../device/images/mute.png" title="Mute icon" width="20%" height="20%">
                    </label>
                    <label for="muteUnmuteApp" class="mute">
                        <img src="../device/images/speaker.png" title="Speaker icon" width="20%" height="20%">
                    </label>
                </div>
            </div>
        </div>
    </div>
    <script>
        //master volume
        $(function() {
            //binds the master volume slider
            $('#masterVolume').bind('input', function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                    Name: "WindowsVolumeMixerControl",
                    Func: "setMasterVolume",
                    Params: $("#masterVolume").val()/100.0,
                    ProcessId: -1 //whatever 
                }, function(data) {
                });
                return false;
            });
        });

        function myOnload() {
            //requests program data from python which requests it from windows
            $.getJSON("http://127.0.0.1:5001" + '/data2', {
                }, function(data) {
                    data.forEach(changeSliderData);
                });
        }
        
        function changeSliderData(value, index){
            //This function add the relative sliders for the data to the html
            //also binds the sliders to send back updates on volume to windows       
            sliderHTML = ' \
                <div class="col-xs-3"> \
                    <input type="range" min="0" max="100" value="' + (value.currentVolume*100) + '" class="slider" id="' + index + '"> \
                    <h3 class="text-center">' + value.name + '</h3> \
                    <input type="checkbox" id="muteUnmuteApp' + index + '" style="display: none;"> \
                    <label for="muteUnmuteApp' + index + '" class="unmute"> \
                        <img src="../device/images/mute.png" title="Mute icon" id="mute' + index + '" style="width: 20%; height: 20%; display: none;"> \
                    </label> \
                    <label for="muteUnmuteApp' + index + '" class="mute"> \
                        <img src="../device/images/speaker.png" title="Speaker icon" id="speaker' + index + '" style="width: 20%; height: 20%; display: initial;"> \
                    </label> \
                </div>'

            $("#sliderContainer").append(sliderHTML)

            $("#"+index).bind('input', function() {
                console.log("Button: " + index + ", Volume: " + $("#"+index).val() + ", PID:" + value.pid)
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                    Name: "WindowsVolumeMixerControl",
                    Func: "setApplicationVolume",
                    Params: $("#"+index).val()/100.0,
                    ProcessId: value.pid
                }, function(data) {
                });
                return false;
            });

            // mute/unmute individual app
            $("#muteUnmuteApp"+index).bind("change", function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                    Name: "WindowsVolumeMixerControl",
                    Func: ($("#muteUnmuteApp"+index).is(':checked') ? "muteApplicationVolume" : "unmuteApplicationVolume"),
                    Params: 0,
                    ProcessId: value.pid
                    }, function(data) {
                        if($("#muteUnmuteApp"+index).is(':checked')){
                            $("#mute"+index).css("display", "initial");
                            $("#speaker"+index).css("display", "none");
                        }
                        else{
                            $("#mute"+index).css("display", "none");
                            $("#speaker"+index).css("display", "initial");
                        }
                });
                return false;
            });
        }

        var pressedApp = false;
        // mute/unmute master
        $(function() {
            $('#muteUnmuteApp').bind("change", function() {
                $.getJSON("http://127.0.0.1:5001" + '/data', {
                Name: "WindowsVolumeMixerControl",
                Func: (pressedApp ? "unmuteMasterVolume" : "muteMasterVolume"),
                Params: 0,
                ProcessId: -1 //whatever
                }, function(data) {
                    pressedApp = !pressedApp
                });
                return false;
            });
        });

    </script>
    <script src="index.js"></script>
  </body>
</html>
